God.watch do |w|
  w.name =        'resque_web'
  w.group =       'resque'
  w.uid = w.gid = 'deploy'
  w.start =       'bundle exec resque-web -p 8888 /data/corndog/current/config/resque_conf.rb'
  w.keepalive
  w.env = { 'RAILS_ENV' => '<%= @rails_env %>',
            'QUEUE'     => '*' }
  w.log = '/data/<%= @app_name %>/shared/log/resque_web.log'
  w.dir = '/data/<%= @app_name %>/current'
end

<% @workers_config.each do |queue, workers_count| %>
<% count = 0 %>
<% workers_count.times do %>
God.watch do |w|
  w.name = "resque_<%= queue %>_<%= count %>"
  w.group = 'resque'
  w.uid = w.gid = 'deploy'
  w.log = '/data/<%= @app_name %>/shared/log/resque_web.log'
  w.dir = '/data/<%= @app_name %>/current'
  w.keepalive
  w.env = { 'RAILS_ENV' => '<%= @rails_env %>',
            'QUEUE'     => '*' }
  w.start = "bundle exec resque <%= @app_name %> start <%= @rails_env %> resque_<%= queue %>_<%= count %>.conf"
  # production alerts go here
  <%# if ['production'].include?(@rails_env) %>
  #alert cdx-alert@manheim.com only on { timeout, nonexist }
  <%# end %>
end
<% count += 1 %>
<% end %>
<% end %>


